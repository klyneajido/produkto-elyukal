version: "3.1"

rules:
# Basic Interaction Rules
- rule: Greet the user
  steps:
    - intent: greet
    - action: utter_greet

- rule: Say goodbye
  steps:
    - intent: goodbye
    - action: utter_goodbye

- rule: Confirm bot identity
  steps:
    - intent: bot_challenge
    - action: utter_iamabot

# Mood-Based Rules
- rule: Cheer up unhappy user
  steps:
    - intent: mood_unhappy
    - action: utter_cheer_up
    - action: utter_did_that_help

- rule: Celebrate great mood
  steps:
    - intent: mood_great
    - action: utter_happy

# Product Inquiry Rules with Forms
- rule: Activate municipality form
  steps:
    - intent: ask_products_by_municipality
    - action: municipality_form
    - active_loop: municipality_form

- rule: Submit municipality form
  condition:
    - active_loop: municipality_form
  steps:
    - action: municipality_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_fetch_products_by_municipality

- rule: Activate location form
  steps:
    - intent: ask_municipality_by_product
    - action: product_location_form
    - active_loop: product_location_form

- rule: Submit location form
  condition:
    - active_loop: product_location_form
  steps:
    - action: product_location_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_find_municipality_by_product

# Form activation for product information with specific forms
- rule: Activate price form
  steps:
    - intent: ask_product_price
    - action: product_price_form
    - active_loop: product_price_form

- rule: Submit price form
  condition:
    - active_loop: product_price_form
  steps:
    - action: product_price_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_get_product_price
    - action: utter_product_price_disclaimer

- rule: Activate availability form
  steps:
    - intent: ask_product_availability
    - action: product_availability_form
    - active_loop: product_availability_form

- rule: Submit availability form
  condition:
    - active_loop: product_availability_form
  steps:
    - action: product_availability_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_get_product_availability
    - action: utter_product_availability_info

- rule: Activate details form
  steps:
    - intent: ask_product_details
    - action: product_details_form
    - active_loop: product_details_form

- rule: Submit details form
  condition:
    - active_loop: product_details_form
  steps:
    - action: product_details_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_provide_product_details

# Fallback and Out-of-Scope Rules
- rule: Handle out-of-scope queries
  steps:
    - intent: out_of_scope
    - action: utter_out_of_scope

- rule: Fallback for unrecognized input
  condition:
    - active_loop: null
  steps:
    - action: action_default_fallback
    - action: utter_fallback